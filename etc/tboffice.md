Title: 全自動DTPシステムを作る話
Subtitle: git pushするとJenkinsの口からPDFが出てくる
Author: @tboffice
Author(romaji): tboffice

# 全自動DTPシステム

　「びゃあ゛ぁ゛゛ぁうまひぃ゛ぃぃ゛ぃ゛」（挨拶 [^1]

[^1]: タイトルは全自動卵割り機をリスペクトしています。全自動卵割り機にバブみを感じてしまったあなたは、かなりの変態さんでは？（おまいう）

　どうも@tbofficeと申します。初めましての方ははじめまして、ご無沙汰の人は「またおまえか！」と思っていることでしょう。第7開発セクションというサークルの中では、雑用をやっております。

　さて、当サークルでは「ななかInside」というIT系の技術本を作っておりまして、コミックマーケットで頒布しております。その本のデータ(PDF)を作る話をします。

## 初期

　あれは三年前くらいになるんですけど、「ななかInside PRESS」 [^2] が世に出ました。その頃は素のLaTeXを使っていて、原稿に `\subsection` などと書いていました。その原稿をgithubにコミットしたものを手動でビルドしていました。その後、糖質制限おじさんとなる前の @j5ik2o さんに Sphinx で行こうよ、と言われて [^3] 、Sphinxでドキュメントをビルドすることになったのでした。

[^2]: 「ななかInside」とか「NANAKA Inside PRESS」とか語気揺れが激しいのは内緒だよっ
[^3]: 唆されたともいう（マテ

## ドーモ=ジェンキンス=サン

　それで自動化の波ですよ。ビッグウエーブですよ。乗るしかないんですよこの波アイエエ(どうすんだよこの流れ)

　えーと、2013年くらいでしたかね、当時筆者が飼っていたVPSにJenkinsおじさんも飼うことにして、githubに置いたreSTから自動でPDFにしてくれる仕組みをつくったんですね。

[TODO] システムの説明と図

## PDF出力の自動化

こうして、PDFのビルドを自動化することに成功したのです。バブれますね？
え？これがバブみだと？ぜんぜんバブれない？ふざけるなと！
なるほど、じゃあDockerイメージでも作ればよいですね。
ということで作りましたのでお使い下さい。

[TODO] つくる

## docker imageを作るにあたって

　作ったdocker imageは TeXLive2015 + Jenkins 1.6系入りのScientific Linuxです。OSは趣味です。

　TeXLiveのインストールはOSのパッケージにあるんですがいかんせん古いのでTeXLive2015をインストールしました。インストールの方法は主に2種類あります。isoファイルを `mount` して実行ファイルをインストールする方法と、ネットワークインストール用のパッケージをダウンロードして実行ファイルからインストールする方法です。

　isoのインストールを試したところ、docker内で `mount -l loop -p hoge.iso` ができませんでした。仕方なくネットワークインストールを試みたんですが、パッケージをインターネットから落としてくるのに2時間くらいかかったので断念。

　仕方ないので、docer server上でisoファイルを展開してそのディレクトリでHTTPサーバを立ち上げて、docker image内からTeXLive2015のインストールに必要なパッケージをwgetする荒業で回避しました。なにやってんだか。

## Sphinx + TeXLiveの欠点

　まずは利点から。githubにpushすると5分くらいで印刷入稿用のPDFが出力されて見た目が確定します。

　欠点としては、LaTeXに起因する、図がどっかに行ってしまう問題があります。LaTeXを使ったことがある人なら一度ならず二度までも、何度も遭遇する現象です。見た目を少し調整するたびにpushしてはビルドして様子見という不毛な作業を繰り返すことになります。

## いまどうしてるの


[TODO] いまはInDesignでやってるけどこれも自動化できたらいいな。InDesign CC Serverがあれば出来るぽいけどつらそう
